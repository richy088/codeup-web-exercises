<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Weather Map Project</title>
    <script src="js/keys.js"></script>
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.10.0/mapbox-gl.js'></script>
    <script src="js/mapbox-geocoder-utils.js"></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.10.0/mapbox-gl.css' rel='stylesheet' />
    <script
            src="https://code.jquery.com/jquery-3.6.1.js"
            integrity="sha256-3zlB5s2uwoUzrXK3BT7AX3FyvojsraNFxCc2vC/7pNI="
            crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
</head>
<body>
<!--<nav class="navbar fixed-top bg-light">-->
<!--    <div class="container-fluid">-->
<!--        <a class="navbar-brand" href="#">Weather App</a>-->
<!--    </div>-->
<!--</nav>-->

<nav class="navbar navbar-dark bg-primary">
    <a class="navbar-brand" href="#">Weather App</a>
    <div id="navLocation" style="color: white">Current city: San Antonio</div>
<!--    When double-clicked, navbar zooms out-->
</nav>

<div class="row g-3 align-items-center">
    <div class="col-auto">
        <label for="locationSearch" class="col-form-label">Place</label>
    </div>
    <div class="col-auto">
        <input type="text" id="inputText" class="form-control" >
    </div>
    <div class="col-auto">
        <button id="findButton" class="btn btn-primary" type="submit">Find</button>
    </div>
</div>

<div class="row align-items-center">
    <div class="col">
        <div class="card" style="width: auto;">
            <div class="card-header">
                Featured
            </div>
            <ul class="list-group list-group-flush">
                <li class="list-group-item">An item</li>
                <li class="list-group-item">A second item</li>
                <li class="list-group-item">A third item</li>
            </ul>
        </div>
    </div>
    <div class="col">
        <div class="card" style="width: auto;">
            <div class="card-header">
                Featured
            </div>
            <ul class="list-group list-group-flush">
                <li class="list-group-item">An item</li>
                <li class="list-group-item">A second item</li>
                <li class="list-group-item">A third item</li>
            </ul>
        </div>
    </div>
    <div class="col">
        <div class="card" style="width: auto;">
            <div class="card-header">
                Featured
            </div>
            <ul class="list-group list-group-flush">
                <li class="list-group-item">An item</li>
                <li class="list-group-item">A second item</li>
                <li class="list-group-item">A third item</li>
            </ul>
        </div>
    </div>
    <div class="col">
        <div class="card" style="width: auto;">
            <div class="card-header">
                Featured
            </div>
            <ul class="list-group list-group-flush">
                <li class="list-group-item">An item</li>
                <li class="list-group-item">A second item</li>
                <li class="list-group-item">A third item</li>
            </ul>
        </div>
    </div>
    <div class="col">
        <div class="card" style="width: auto;">
            <div class="card-header">
                Featured
            </div>
            <ul class="list-group list-group-flush">
                <li class="list-group-item">An item</li>
                <li class="list-group-item">A second item</li>
                <li class="list-group-item">A third item</li>
            </ul>
        </div>
    </div>
</div>

<div id='map' style='width: 1000px; height: 750px;'></div>

    <script>
        // $.get("http://api.openweathermap.org/data/2.5/weather", {
        //     APPID: WEATHER_KEY,
        //      q: "San Antonio, US",
        //     units: "imperial"
        // }).done(function(data) {
        //     let weatherDescription = data.weather[0].description;
        //     let tempKey = data.main.temp;
        // console.log(data);
        // console.log(weatherDescription);
        // });

        // $.get("http://api.openweathermap.org/data/2.5/forecast", {
        //     APPID: WEATHER_KEY,
        //     lat:    29.423017,
        //     lon:   -98.48527,
        //     units: "imperial"
        // }).done(function(data) {
        //     console.log('5 day forecast', data);
        // });

        // api.openweathermap.org/data/2.5/forecast?lat={lat}&lon={lon}&appid={WEATHER_KEY}

        mapboxgl.accessToken = MAPBOX_KEY;
        const map = new mapboxgl.Map({
            container: 'map', // container ID
            style: 'mapbox://styles/mapbox/streets-v11', // style URL
            center: [-98.491142, 29.424349], // starting position [lng, lat]
            zoom: 4, // starting zoom
            projection: 'globe' // display the map as a 3D globe
        });
        map.on('style.load', () => {
            map.setFog({}); // Set the default atmosphere style
        });
        //
        // geocode("austin, texas", MAPBOX_KEY).then(function(result) {
        //
        //     map.setZoom(5);
        //
        //     let markerFood = new mapboxgl.Marker()
        //         .setLngLat([result[0], result[1]])
        //         .addTo(map);
        // });

        //as of right now, adds multiple markers with button click without refresh

        $('#findButton').click(function (e){
            e.preventDefault();
            let destination = document.querySelector('#inputText')
            geocode(destination.value, MAPBOX_KEY).then(function(result) {

                // map.setZoom(10);
                // map.center([result[0], result[1]]); something is wrong with this thing

                let markerFood = new mapboxgl.Marker()
                    .setLngLat([result[0], result[1]])
                    .addTo(map);

                $.get("http://api.openweathermap.org/data/2.5/forecast", {
                    APPID: WEATHER_KEY,
                    lat:    result[1],
                    lon:    result[0],
                    units: "imperial"
                }).done(function(data) {
                    console.log('5 day forecast', data);
                });

            });

            $('#navLocation').html(`Current city: ${destination.value}`);


        });
    </script>
</body>
</html>